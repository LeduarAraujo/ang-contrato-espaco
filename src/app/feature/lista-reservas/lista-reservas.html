<div class="container">
  <div class="header">
    <h1>Reservas</h1>
    <p>Visualize todas as reservas agendadas e seus detalhes</p>
  </div>

  <!-- Filtros -->
  <div class="filters-section">
    <div class="filters-header">
      <h3>Filtros</h3>
      <button class="btn btn-secondary btn-sm" (click)="limparFiltros()">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M3 6H21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M8 6V4C8 3.44772 8.44772 3 9 3H15C15.5523 3 16 3.44772 16 4V6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M19 6V20C19 20.5523 18.5523 21 18 21H6C5.44772 21 5 20.5523 5 20V6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        Limpar Filtros
      </button>
    </div>

    <div class="filters-grid">
      <!-- Filtro por Espaço -->
      <div class="filter-group">
        <label for="filtroEspaco">Espaço</label>
        <select
          id="filtroEspaco"
          [(ngModel)]="filtroEspaco"
          class="form-control"
        >
          <option [value]="null">Todos os espaços</option>
          <option *ngFor="let espaco of espacos()" [value]="espaco.id">
            {{ espaco.nome }}
          </option>
        </select>
      </div>

      <!-- Filtro por Mês -->
      <div class="filter-group">
        <label for="filtroMes">Mês</label>
        <select
          id="filtroMes"
          [(ngModel)]="filtroMes"
          class="form-control"
        >
          <option value="">Todos os meses</option>
          <option *ngFor="let mes of getOpcoesMes()" [value]="mes">
            {{ formatarMes(mes) }}
          </option>
        </select>
      </div>

      <!-- Filtro por Pagamento -->
      <div class="filter-group">
        <label for="filtroPagamento">Pagamento</label>
        <select
          id="filtroPagamento"
          [(ngModel)]="filtroPagamento"
          class="form-control"
        >
          <option value="todos">Todos</option>
          <option value="integral">Integral</option>
          <option value="parcial">Parcial</option>
        </select>
      </div>
    </div>

    <div class="filters-row">
      <button class="btn btn-primary" (click)="registrarReserva()">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M12 5V19" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M5 12H19" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        Registrar Reserva
      </button>
    </div>
  </div>

  <!-- Lista de Reservas -->
  <div class="list-section">
    <div class="section-header">
      <h2>Reservas Agendadas</h2>
      <span class="total-count">{{ getReservasFiltradas().length }} reserva(s) encontrada(s)</span>
    </div>

    <div *ngIf="loading()" class="loading">
      <p>Carregando reservas...</p>
    </div>

    <div *ngIf="!loading() && getReservasFiltradas().length === 0" class="empty-state">
      <p>Nenhuma reserva encontrada.</p>
    </div>

    <div *ngIf="!loading() && getReservasFiltradas().length > 0" class="festas-grid">
      <div *ngFor="let reserva of getReservasPaginadas()" class="festa-card">
        <!-- Cabeçalho do Card -->
        <div class="festa-header">
          <div class="festa-info">
            <div class="festa-main-info">
              <h3>{{ reserva.nomeCliente }}</h3>
              <span class="espaco-festa">{{ getNomeEspaco(reserva) }}</span>
              <span class="data-festa">{{ formatarDataComDiaSemana(reserva.dataFesta) }}</span>
              <span class="horario-festa">{{ reserva.horaInicio }} - {{ reserva.horaFim }}</span>
              <span class="valor-festa">{{ formatarValor(reserva.valorPagamento) }}</span>
              <span class="status-pagamento" [class]="getStatusPagamentoClass(reserva)">
                {{ getStatusPagamento(reserva) }}
              </span>
            </div>
          </div>
          <button
            class="btn btn-primary btn-sm"
            (click)="alternarDetalhes(reserva.id!)"
            [title]="reservaExpandida() === reserva.id ? 'Ocultar detalhes' : 'Ver detalhes'"
          >
            <svg *ngIf="reservaExpandida() !== reserva.id" width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M6 9L12 15L18 9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <svg *ngIf="reservaExpandida() === reserva.id" width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M18 15L12 9L6 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            {{ reservaExpandida() === reserva.id ? 'Ocultar' : 'Detalhar' }}
          </button>
        </div>

        <!-- Detalhes Expandidos -->
        <div *ngIf="reservaExpandida() === reserva.id" class="festa-details-expanded">
          <div class="details-grid">
            <div class="detail-item">
              <span class="label">CPF/CNPJ:</span>
              <span class="value">{{ formatarCPF(reserva.cpfCliente) }}</span>
            </div>
            <div class="detail-item">
              <span class="label">Telefone:</span>
              <span class="value">{{ reserva.telefoneCliente }}</span>
            </div>
            <div class="detail-item">
              <span class="label">Valor Pago:</span>
              <span class="value valor">{{ formatarValor(reserva.valorPagamento) }}</span>
            </div>
            <div class="detail-item" *ngIf="!reserva.valorIntegral && reserva.valorRestante">
              <span class="label">Valor Restante:</span>
              <span class="value valor">{{ formatarValor(reserva.valorRestante) }}</span>
            </div>
            <div class="detail-item" *ngIf="reserva.id">
              <span class="label">ID da Reserva:</span>
              <span class="value">{{ reserva.id }}</span>
            </div>
            <div class="detail-item" *ngIf="reserva.createdAt">
              <span class="label">Criado em:</span>
              <span class="value">{{ reserva.createdAt | date:'dd/MM/yyyy HH:mm' }}</span>
            </div>
          </div>

          <!-- Botões de Ação -->
          <div class="action-buttons">
            <button class="btn btn-success btn-sm" (click)="editarReserva(reserva)">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M11 4H4C3.46957 4 2.96086 4.21071 2.58579 4.58579C2.21071 4.96086 2 5.46957 2 6V20C2 20.5304 2.21071 21.0391 2.58579 21.4142C2.96086 21.7893 3.46957 22 4 22H18C18.5304 22 19.0391 21.7893 19.4142 21.4142C19.7893 21.0391 20 20.5304 20 20V13" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M18.5 2.5C18.8978 2.10218 19.4374 1.87868 20 1.87868C20.5626 1.87868 21.1022 2.10218 21.5 2.5C21.8978 2.89782 22.1213 3.43739 22.1213 4C22.1213 4.56261 21.8978 5.10218 21.5 5.5L12 15L8 16L9 12L18.5 2.5Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              Editar Reserva
            </button>

            <button class="btn btn-info btn-sm" (click)="gerarPdf(reserva)">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M14 2H6C5.46957 2 4.96086 2.21071 4.58579 2.58579C4.21071 2.96086 4 3.46957 4 4V20C4 20.5304 4.21071 21.0391 4.58579 21.4142C4.96086 21.7893 5.46957 22 6 22H18C18.5304 22 19.0391 21.7893 19.4142 21.4142C19.7893 21.0391 20 20.5304 20 20V8L14 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M14 2V8H20" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M16 13H8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M16 17H8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M10 9H8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              Gerar PDF
            </button>

            <button class="btn btn-danger btn-sm" (click)="excluirReserva(reserva)">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M3 6H5H21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M8 6V4C8 3.44772 8.44772 3 9 3H15C15.5523 3 16 3.44772 16 4V6M19 6V20C19 20.5523 18.5523 21 18 21H6C5.44772 21 5 20.5523 5 20V6H19Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M10 11V17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <path d="M14 11V17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
              Excluir Reserva
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Paginação -->
    <div *ngIf="!loading() && getReservasFiltradas().length > 0 && getTotalPaginas() > 1" class="pagination-section">
      <div class="pagination-info">
        <span>
          Página {{ paginaAtual() }} de {{ getTotalPaginas() }}
          ({{ getReservasFiltradas().length }} reserva(s) no total)
        </span>
      </div>

      <div class="pagination-controls">
        <button
          class="btn btn-secondary btn-sm"
          [disabled]="paginaAtual() === 1"
          (click)="paginaAnterior()"
        >
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M15 18L9 12L15 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          Anterior
        </button>

        <div class="pagination-numbers">
          <button
            *ngFor="let pagina of getPaginas()"
            class="btn btn-sm"
            [class.btn-primary]="pagina === paginaAtual()"
            [class.btn-secondary]="pagina !== paginaAtual()"
            (click)="irParaPagina(pagina)"
          >
            {{ pagina }}
          </button>
        </div>

        <button
          class="btn btn-secondary btn-sm"
          [disabled]="paginaAtual() === getTotalPaginas()"
          (click)="proximaPagina()"
        >
          Próxima
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M9 18L15 12L9 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
      </div>
    </div>
  </div>
</div>
