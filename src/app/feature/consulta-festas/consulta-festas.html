<div class="container">
  <div class="header">
    <h1>Consulta de Festas</h1>
    <p>Visualize todas as festas agendadas e seus detalhes</p>
  </div>

  <!-- Filtros -->
  <div class="filters-section">
    <div class="filters-header">
      <h3>Filtros</h3>
      <button class="btn btn-secondary btn-sm" (click)="limparFiltros()">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M3 6H21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M8 6V4C8 3.44772 8.44772 3 9 3H15C15.5523 3 16 3.44772 16 4V6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M19 6V20C19 20.5523 18.5523 21 18 21H6C5.44772 21 5 20.5523 5 20V6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        Limpar Filtros
      </button>
    </div>

    <div class="filters-grid">
      <!-- Filtro por Espaço -->
      <div class="filter-group">
        <label for="filtroEspaco">Espaço</label>
        <select
          id="filtroEspaco"
          [(ngModel)]="filtroEspaco"
          class="form-control"
        >
          <option [value]="null">Todos os espaços</option>
          <option *ngFor="let espaco of espacos()" [value]="espaco.id">
            {{ espaco.nome }}
          </option>
        </select>
      </div>

      <!-- Filtro por Mês -->
      <div class="filter-group">
        <label for="filtroMes">Mês</label>
        <select
          id="filtroMes"
          [(ngModel)]="filtroMes"
          class="form-control"
        >
          <option value="">Todos os meses</option>
          <option *ngFor="let mes of getOpcoesMes()" [value]="mes">
            {{ formatarMes(mes) }}
          </option>
        </select>
      </div>

      <!-- Filtro por Pagamento -->
      <div class="filter-group">
        <label for="filtroPagamento">Pagamento</label>
        <select
          id="filtroPagamento"
          [(ngModel)]="filtroPagamento"
          class="form-control"
        >
          <option value="todos">Todos</option>
          <option value="integral">Integral</option>
          <option value="parcial">Parcial</option>
        </select>
      </div>
    </div>

    <div class="filters-row">
      <button
        class="btn btn-secondary"
        [class.active]="filtroSemana()"
        (click)="ativarFiltroSemana()"
      >
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M8 2V5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M16 2V5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M3 10H21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M5 4H19C20.1046 4 21 4.89543 21 6V20C21 21.1046 20.1046 22 19 22H5C3.89543 22 3 21.1046 3 20V6C3 4.89543 3.89543 4 5 4Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M3 10H21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        {{ filtroSemana() ? 'Todas as Festas' : 'Festas da Semana' }}
      </button>
      <button
        class="btn btn-info"
        (click)="abrirModalDatas()"
      >
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M8 2V5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M16 2V5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M3 10H21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M5 4H19C20.1046 4 21 4.89543 21 6V20C21 21.1046 20.1046 22 19 22H5C3.89543 22 3 21.1046 3 20V6C3 4.89543 3.89543 4 5 4Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M3 10H21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        Datas Disponíveis
      </button>
    </div>
  </div>

  <!-- Caixas de Texto das Festas da Semana -->
  <div *ngIf="mostrarCaixasTexto()" class="caixas-texto-section">
    <div class="section-header">
      <div class="section-title">
        <h2>Festas da Semana - Caixas de Texto</h2>
        <span class="total-count">{{ getFestasPorEspaco().length }} espaço(s) com festas</span>
      </div>
      <button
        class="btn btn-secondary btn-sm"
        (click)="ativarFiltroSemana()"
        title="Fechar seção de festas da semana"
      >
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M18 6L6 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        Fechar
      </button>
    </div>

    <div *ngIf="getFestasPorEspaco().length === 0" class="empty-state">
      <p>Nenhuma festa encontrada para esta semana.</p>
    </div>

    <div *ngIf="getFestasPorEspaco().length > 0" class="caixas-texto-grid">
      <div *ngFor="let item of getFestasPorEspaco()" class="caixa-texto-card">
        <div class="caixa-texto-header">
          <h3>{{ item.espaco.nome }}</h3>
          <button
            class="btn btn-success btn-sm"
            (click)="copiarTexto(item.espaco, item.festas)"
            title="Copiar texto das festas"
          >
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M16 4H18C19.1046 4 20 4.89543 20 6V18C20 19.1046 19.1046 20 18 20H6C4.89543 20 4 19.1046 4 18V6C4 4.89543 4.89543 4 6 4H8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M8 2H16C17.1046 2 18 2.89543 18 4V6C18 7.10457 17.1046 8 16 8H8C6.89543 8 6 7.10457 6 6V4C6 2.89543 6.89543 2 8 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            Copiar
          </button>
        </div>
        <div class="caixa-texto-content">
          <pre>{{ gerarTextoFestas(item.espaco, item.festas) }}</pre>
        </div>
      </div>
    </div>
  </div>

  <!-- Caixas de Texto das Datas Disponíveis -->
  <div *ngIf="mostrarDatasDisponiveis()" class="caixas-texto-section">
    <div class="section-header">
      <div class="section-title">
        <h2>Datas Disponíveis - Caixas de Texto</h2>
        <span class="total-count">{{ getDatasDisponiveisPorEspaco().length }} espaço(s) com datas disponíveis</span>
      </div>
      <button
        class="btn btn-secondary btn-sm"
        (click)="mostrarDatasDisponiveis.set(false)"
        title="Fechar seção de datas disponíveis"
      >
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M18 6L6 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        Fechar
      </button>
    </div>

    <div *ngIf="getDatasDisponiveisPorEspaco().length === 0" class="empty-state">
      <p>Nenhuma data disponível encontrada no período selecionado.</p>
    </div>

    <div *ngIf="getDatasDisponiveisPorEspaco().length > 0" class="caixas-texto-grid">
      <div *ngFor="let item of getDatasDisponiveisPorEspaco()" class="caixa-texto-card">
        <div class="caixa-texto-header">
          <h3>{{ item.espaco.nome }}</h3>
          <button
            class="btn btn-success btn-sm"
            (click)="copiarTextoDatas(item.espaco, item.datas)"
            title="Copiar texto das datas disponíveis"
          >
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M16 4H18C19.1046 4 20 4.89543 20 6V18C20 19.1046 19.1046 20 18 20H6C4.89543 20 4 19.1046 4 18V6C4 4.89543 4.89543 4 6 4H8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <path d="M8 2H16C17.1046 2 18 2.89543 18 4V6C18 7.10457 17.1046 8 16 8H8C6.89543 8 6 7.10457 6 6V4C6 2.89543 6.89543 2 8 2Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            Copiar
          </button>
        </div>
        <div class="caixa-texto-content">
          <pre>{{ gerarTextoDatasDisponiveis(item.espaco, item.datas) }}</pre>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal de Configuração de Datas -->
  <div *ngIf="mostrarModalDatas()" class="modal-overlay" (click)="fecharModalDatas()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>Configurar Período para Datas Disponíveis</h3>
        <button class="modal-close" (click)="fecharModalDatas()" title="Fechar modal" aria-label="Fechar modal">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M18 6L6 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
      </div>

      <div class="modal-body">
        <div class="form-group">
          <label for="dataInicio">Data de Início</label>
          <input
            type="date"
            id="dataInicio"
            [(ngModel)]="dataInicio"
            class="form-control"
          >
        </div>

        <div class="form-group">
          <label for="dataFim">Data de Fim</label>
          <input
            type="date"
            id="dataFim"
            [(ngModel)]="dataFim"
            class="form-control"
          >
        </div>

        <div class="form-group">
          <label for="tipoDias">Tipo de Dias</label>
          <select
            id="tipoDias"
            [(ngModel)]="tipoDias"
            class="form-control"
          >
            <option value="todos">Todos os dias</option>
            <option value="finais">Finais de semana</option>
            <option value="dias-semana">Dias de semana</option>
          </select>
        </div>
      </div>

      <div class="modal-footer">
        <button class="btn btn-secondary" (click)="fecharModalDatas()">
          Cancelar
        </button>
        <button class="btn btn-primary" (click)="gerarRelatorioDatasDisponiveis()">
          Gerar Relatório
        </button>
      </div>
    </div>
  </div>

  <!-- Lista de Festas -->
  <div class="list-section">
    <div class="section-header">
      <h2>Festas Agendadas</h2>
      <span class="total-count">{{ getRelatoriosFiltrados().length }} festa(s) encontrada(s)</span>
    </div>

    <div *ngIf="loading()" class="loading">
      <p>Carregando festas...</p>
    </div>

    <div *ngIf="!loading() && getRelatoriosFiltrados().length === 0" class="empty-state">
      <p>Nenhuma festa encontrada.</p>
    </div>

    <div *ngIf="!loading() && getRelatoriosFiltrados().length > 0" class="festas-grid">
      <div *ngFor="let relatorio of getRelatoriosPaginados()" class="festa-card">
        <!-- Cabeçalho do Card -->
        <div class="festa-header">
          <div class="festa-info">
            <h3>{{ relatorio.nomeCliente }}</h3>
            <div class="festa-details">
              <span class="espaco-festa">{{ getNomeEspaco(relatorio) }}</span>
              <span class="data-festa">{{ formatarDataComDiaSemana(relatorio.dataFesta) }}</span>
              <span class="status-pagamento" [class]="getStatusPagamentoClass(relatorio)">
                {{ getStatusPagamento(relatorio) }}
              </span>
            </div>
          </div>
          <button
            class="btn btn-primary btn-sm"
            (click)="alternarDetalhes(relatorio.id!)"
            [title]="relatorioExpandido() === relatorio.id ? 'Ocultar detalhes' : 'Ver detalhes'"
          >
            <svg *ngIf="relatorioExpandido() !== relatorio.id" width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M6 9L12 15L18 9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <svg *ngIf="relatorioExpandido() === relatorio.id" width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M18 15L12 9L6 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            {{ relatorioExpandido() === relatorio.id ? 'Ocultar' : 'Detalhar' }}
          </button>
        </div>

        <!-- Detalhes Expandidos -->
        <div *ngIf="relatorioExpandido() === relatorio.id" class="festa-details-expanded">
          <div class="details-grid">
            <div class="detail-item">
              <span class="label">CPF/CNPJ:</span>
              <span class="value">{{ formatarCPF(relatorio.cpfCliente) }}</span>
            </div>
            <div class="detail-item">
              <span class="label">Horário:</span>
              <span class="value">{{ relatorio.horaInicio }} - {{ relatorio.horaFim }}</span>
            </div>
            <div class="detail-item">
              <span class="label">Valor:</span>
              <span class="value valor">{{ formatarValor(relatorio.valorPago) }}</span>
            </div>
            <div class="detail-item">
              <span class="label">ID do Relatório:</span>
              <span class="value">{{ relatorio.id }}</span>
            </div>
            <div class="detail-item" *ngIf="relatorio.createdAt">
              <span class="label">Gerado em:</span>
              <span class="value">{{ relatorio.createdAt | date:'dd/MM/yyyy HH:mm' }}</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Paginação -->
    <div *ngIf="!loading() && getRelatoriosFiltrados().length > 0 && getTotalPaginas() > 1" class="pagination-section">
      <div class="pagination-info">
        <span>
          Página {{ paginaAtual() }} de {{ getTotalPaginas() }}
          ({{ getRelatoriosFiltrados().length }} festa(s) no total)
        </span>
      </div>

      <div class="pagination-controls">
        <button
          class="btn btn-secondary btn-sm"
          [disabled]="paginaAtual() === 1"
          (click)="paginaAnterior()"
        >
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M15 18L9 12L15 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          Anterior
        </button>

        <div class="pagination-numbers">
          <button
            *ngFor="let pagina of getPaginas()"
            class="btn btn-sm"
            [class.btn-primary]="pagina === paginaAtual()"
            [class.btn-secondary]="pagina !== paginaAtual()"
            (click)="irParaPagina(pagina)"
          >
            {{ pagina }}
          </button>
        </div>

        <button
          class="btn btn-secondary btn-sm"
          [disabled]="paginaAtual() === getTotalPaginas()"
          (click)="proximaPagina()"
        >
          Próxima
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M9 18L15 12L9 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
      </div>
    </div>
  </div>
</div>
