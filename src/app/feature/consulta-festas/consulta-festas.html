<div class="container">
  <div class="header">
    <h1>Consulta de Festas</h1>
    <p>Visualize festas agendadas, datas disponíveis e consulte reservas específicas</p>
  </div>

  <!-- Seção 1: Festas da Semana -->
  <div class="section-card">
    <div class="section-header">
      <div class="section-title">
        <div class="section-icon">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M8 2V5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M16 2V5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M3 10H21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M5 4H19C20.1046 4 21 4.89543 21 6V20C21 21.1046 20.1046 22 19 22H5C3.89543 22 3 21.1046 3 20V6C3 4.89543 3.89543 4 5 4Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </div>
        <h2>Festas da Semana</h2>
      </div>
      <button
        class="btn btn-primary btn-sm"
        (click)="alternarFestasSemana()"
        [title]="mostrarFestasSemana() ? 'Ocultar detalhes' : 'Ver detalhes'"
      >
        <svg *ngIf="!mostrarFestasSemana()" width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M6 9L12 15L18 9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <svg *ngIf="mostrarFestasSemana()" width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M18 15L12 9L6 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        {{ mostrarFestasSemana() ? 'Ocultar' : 'Detalhar' }}
      </button>
    </div>

    <div *ngIf="mostrarFestasSemana()" class="section-content">
      <div class="form-group">
        <label for="espacoSemana">Selecione o Espaço</label>
        <select
          id="espacoSemana"
          [(ngModel)]="espacoSelecionadoSemana"
          class="form-control"
        >
          <option [value]="null">Selecione um espaço</option>
          <option *ngFor="let espaco of espacos()" [value]="espaco.id">
            {{ espaco.nome }}
          </option>
        </select>
      </div>

      <div *ngIf="espacoSelecionadoSemana()" class="festas-content">
        <div *ngIf="getFestasSemanaPorEspaco().length === 0" class="empty-state">
          <p>Nenhuma festa encontrada para este espaço nesta semana.</p>
        </div>

        <div *ngIf="getFestasSemanaPorEspaco().length > 0" class="festas-list">
          <h4>Festas de {{ getNomeEspacoPorId(espacoSelecionadoSemana()!) }} nesta semana:</h4>
          <div class="festa-item" *ngFor="let festa of getFestasSemanaPorEspaco()">
            <div class="festa-info">
              <h5>{{ festa.nomeCliente }}</h5>
              <p><strong>Data:</strong> {{ formatarDataComDiaSemana(festa.dataFesta) }}</p>
              <p><strong>Horário:</strong> {{ festa.horaInicio }} às {{ festa.horaFim }}</p>
              <p><strong>Telefone:</strong> {{ festa.telefoneCliente }}</p>
              <p><strong>Valor:</strong> {{ formatarValor(festa.valorPagamento) }}</p>
              <p><strong>Pagamento:</strong>
                <span [class]="getStatusPagamentoClass(festa)">
                  {{ getStatusPagamento(festa) }}
                </span>
              </p>
            </div>
          </div>

          <button
            class="btn btn-secondary btn-sm"
            (click)="copiarFestasSemana()"
          >
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M16 4H18C19.1046 4 20 4.89543 20 6V18C20 19.1046 19.1046 20 18 20H6C4.89543 20 4 19.1046 4 18V6C4 4.89543 4.89543 4 6 4H8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <rect x="8" y="2" width="8" height="4" rx="1" ry="1" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            Copiar Lista
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Seção 2: Datas Disponíveis -->
  <div class="section-card">
    <div class="section-header">
      <div class="section-title">
        <div class="section-icon">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M8 2V5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M16 2V5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M3 10H21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M5 4H19C20.1046 4 21 4.89543 21 6V20C21 21.1046 20.1046 22 19 22H5C3.89543 22 3 21.1046 3 20V6C3 4.89543 3.89543 4 5 4Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M9 16L11 18L15 14" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </div>
        <h2>Datas Disponíveis</h2>
      </div>
      <button
        class="btn btn-primary btn-sm"
        (click)="alternarDatasDisponiveis()"
        [title]="mostrarDatasDisponiveis() ? 'Ocultar detalhes' : 'Ver detalhes'"
      >
        <svg *ngIf="!mostrarDatasDisponiveis()" width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M6 9L12 15L18 9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <svg *ngIf="mostrarDatasDisponiveis()" width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M18 15L12 9L6 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        {{ mostrarDatasDisponiveis() ? 'Ocultar' : 'Detalhar' }}
      </button>
    </div>

    <div *ngIf="mostrarDatasDisponiveis()" class="section-content">
      <div class="form-group">
        <label for="espacoDatas">Selecione o Espaço</label>
        <select
          id="espacoDatas"
          [(ngModel)]="espacoSelecionadoDatas"
          class="form-control"
        >
          <option [value]="null">Selecione um espaço</option>
          <option *ngFor="let espaco of espacos()" [value]="espaco.id">
            {{ espaco.nome }}
          </option>
        </select>
      </div>

      <div *ngIf="espacoSelecionadoDatas()" class="datas-content">
        <button class="btn btn-secondary btn-sm" (click)="abrirModalDatas()">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M8 2V5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M16 2V5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M3 10H21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M5 4H19C20.1046 4 21 4.89543 21 6V20C21 21.1046 20.1046 22 19 22H5C3.89543 22 3 21.1046 3 20V6C3 4.89543 3.89543 4 5 4Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          Configurar Período
        </button>

        <div *ngIf="dataInicio() && dataFim()" class="datas-list">
          <h4>Datas disponíveis para {{ getNomeEspacoPorId(espacoSelecionadoDatas()!) }}:</h4>
          <div *ngIf="getDatasDisponiveisPorEspacoSelecionado().length === 0" class="empty-state">
            <p>Nenhuma data disponível no período selecionado para este espaço.</p>
          </div>

          <div *ngIf="getDatasDisponiveisPorEspacoSelecionado().length > 0" class="dates-grid">
            <div class="date-item" *ngFor="let data of getDatasDisponiveisPorEspacoSelecionado()">
              {{ data | date:'dd/MM/yyyy' }}
            </div>
          </div>

          <button
            *ngIf="dataInicio() && dataFim()"
            class="btn btn-secondary btn-sm"
            (click)="copiarDatasDisponiveis()"
          >
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M16 4H18C19.1046 4 20 4.89543 20 6V18C20 19.1046 19.1046 20 18 20H6C4.89543 20 4 19.1046 4 18V6C4 4.89543 4.89543 4 6 4H8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              <rect x="8" y="2" width="8" height="4" rx="1" ry="1" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            Copiar Datas
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Seção 3: Consulta de Data Específica -->
  <div class="section-card">
    <div class="section-header">
      <div class="section-title">
        <div class="section-icon">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <circle cx="11" cy="11" r="8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M21 21L16.65 16.65" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </div>
        <h2>Consultar Data</h2>
      </div>
      <button
        class="btn btn-primary btn-sm"
        (click)="alternarConsultaData()"
        [title]="mostrarConsultaData() ? 'Ocultar detalhes' : 'Ver detalhes'"
      >
        <svg *ngIf="!mostrarConsultaData()" width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M6 9L12 15L18 9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <svg *ngIf="mostrarConsultaData()" width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M18 15L12 9L6 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        {{ mostrarConsultaData() ? 'Ocultar' : 'Detalhar' }}
      </button>
    </div>

    <div *ngIf="mostrarConsultaData()" class="section-content">
      <div class="form-row">
        <div class="form-group">
          <label for="dataConsulta">Data</label>
          <input
            type="date"
            id="dataConsulta"
            [(ngModel)]="dataConsulta"
            class="form-control"
          >
        </div>

        <div class="form-group">
          <label for="espacoConsulta">Espaço</label>
          <select
            id="espacoConsulta"
            [(ngModel)]="espacoConsulta"
            class="form-control"
          >
            <option [value]="null">Selecione um espaço</option>
            <option *ngFor="let espaco of espacos()" [value]="espaco.id">
              {{ espaco.nome }}
            </option>
          </select>
        </div>
      </div>

      <button
        class="btn btn-primary"
        (click)="consultarData()"
        [disabled]="loadingConsulta() || !dataConsulta() || !espacoConsulta()"
      >
        <svg *ngIf="loadingConsulta()" width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M12 6V12L16 14" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <svg *ngIf="!loadingConsulta()" width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <circle cx="11" cy="11" r="8" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M21 21L16.65 16.65" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        {{ loadingConsulta() ? 'Consultando...' : 'Consultar' }}
      </button>

      <div *ngIf="reservaEncontrada()" class="reserva-encontrada">
        <h4>Reserva Encontrada</h4>
        <div class="reserva-card">
          <div class="reserva-info">
            <h5>{{ reservaEncontrada()?.nomeCliente }}</h5>
            <p><strong>Data:</strong> {{ formatarDataComDiaSemana(reservaEncontrada()!.dataFesta) }}</p>
            <p><strong>Horário:</strong> {{ reservaEncontrada()?.horaInicio }} às {{ reservaEncontrada()?.horaFim }}</p>
            <p><strong>Telefone:</strong> {{ reservaEncontrada()?.telefoneCliente }}</p>
            <p><strong>CPF/CNPJ:</strong> {{ reservaEncontrada()?.cpfCliente ? formatarCPF(reservaEncontrada()!.cpfCliente) : 'N/A' }}</p>
            <p><strong>Valor:</strong> {{ formatarValor(reservaEncontrada()!.valorPagamento) }}</p>
            <p><strong>Pagamento:</strong>
              <span [class]="getStatusPagamentoClass(reservaEncontrada()!)">
                {{ getStatusPagamento(reservaEncontrada()!) }}
              </span>
            </p>
            <p *ngIf="reservaEncontrada()?.valorRestante && reservaEncontrada()!.valorRestante! > 0">
              <strong>Valor Restante:</strong> {{ formatarValor(reservaEncontrada()!.valorRestante!) }}
            </p>
          </div>
        </div>
      </div>

      <div *ngIf="!reservaEncontrada() && !loadingConsulta() && dataConsulta() && espacoConsulta()" class="empty-state">
        <p>Nenhuma reserva encontrada para a data e espaço selecionados.</p>
      </div>
    </div>
  </div>

  <!-- Modal de Configuração de Datas -->
  <div *ngIf="mostrarModalDatas()" class="modal-overlay" (click)="fecharModalDatas()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>Configurar Período</h3>
        <button class="btn-close" (click)="fecharModalDatas()" title="Fechar modal">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M6 18L18 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
      </div>

      <div class="modal-body">
        <div class="form-group">
          <label for="dataInicio">Data de Início</label>
          <input
            type="date"
            id="dataInicio"
            [(ngModel)]="dataInicio"
            class="form-control"
          >
        </div>

        <div class="form-group">
          <label for="dataFim">Data de Fim</label>
          <input
            type="date"
            id="dataFim"
            [(ngModel)]="dataFim"
            class="form-control"
          >
        </div>

        <div class="form-group">
          <label for="tipoDias">Tipo de Dias</label>
          <select
            id="tipoDias"
            [(ngModel)]="tipoDias"
            class="form-control"
          >
            <option value="todos">Todos os dias</option>
            <option value="finais">Finais de semana</option>
            <option value="dias-semana">Dias de semana</option>
          </select>
        </div>
      </div>

      <div class="modal-footer">
        <button class="btn btn-secondary" (click)="fecharModalDatas()">
          Cancelar
        </button>
        <button class="btn btn-primary" (click)="fecharModalDatas()">
          Aplicar
        </button>
      </div>
    </div>
  </div>
</div>
